specVersion: 0.0.4
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum/contract
    name: yamato
    network: rinkeby
    source:
      address: "0xd93feb7ab94cc29ed6d4268bb90f8db96cc21fa8"   #rinkebyデプロイ後に追加
      abi: yamato 
      startBlock: 9500000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Event
        - Deposit
        - Withdraw
        - Borrow
        - Repay
        - Redeem
        - Sweep
        - Pledge
        - WorldState
      abis:
        - name: yamato
          file: ./abis/yamato.json #コントラクト完成後に追加
      eventHandlers:
        - event: Deposited(indexed address,uint256) #ethAmount
          handler: handleDeposit
        - event: Withdrawn(indexed address,uint256) #ethAmount
          handler: handleWithdraw
        - event: Borrowed(indexed address,uint256,uint256) #cjpyAmount, fee
          handler: handleBorrow
        - event: Repaid(indexed address,uint256) #cjpyAmount
          handler: handleRepay
        - event: Redeemed(indexed address,uint256,uint256,address[]) #sender, cjpyAmount, ethAmount
          handler: handleRedeem
        - event: RedeemedMeta(indexed address,uint256,bool,uint256) #sender, price, isCoreRedemption, gasCompensation
          handler: handleRedeemMeta
        - event: Swept(indexed address,uint256,uint256,address[]) #cjpyAmount, gasCompensationAmount
          handler: handleSweep
      file: ./src/mapping.ts
  - kind: ethereum/contract
    name: Cjpy
    network: rinkeby
    source:
      address: "0xae188e37f1d918ed7fc81a6037ce1682d8ffad8e"
      abi: cjpy
      startBlock: 9500000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - WorldState
      abis:
        - name: cjpy
          file: ./abis/cjpy.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleMintAndBurn
      file: ./src/mapping.ts
  - kind: ethereum/contract
    name: priceFeed
    network: rinkeby
    source:
      address: "0x2c0f4a0b42827171f833451b7695de7137e6aed3"
      abi: priceFeed
      startBlock: 9500000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - WorldState
      abis:
        - name: priceFeed
          file: ./abis/priceFeed.json
      eventHandlers:
        - event: LastGoodPriceUpdated(uint256)
          handler: handleFetchPrice
      file: ./src/mapping.ts
  - kind: ethereum/contract
    name: pool
    network: rinkeby
    source:
      address: "0xb86e7e12696ed2758A51eB5A54817Fa4E09a52D2"
      abi: pool
      startBlock: 9500000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - WorldState
      abis:
        - name: pool
          file: ./abis/pool.json
      eventHandlers:
        - event: RedemptionReserveDeposited(address,uint256,uint256)
          handler: handleRedemptionReserve
        - event: RedemptionReserveUsed(address,uint256,uint256)
          handler: handleRedemptionReserve
        - event: SweepReserveDeposited(address,uint256,uint256)
          handler: handleSweepReserve
        - event: SweepReserveUsed(address,uint256,uint256)
          handler: handleSweepReserve
      file: ./src/mapping.ts
    
